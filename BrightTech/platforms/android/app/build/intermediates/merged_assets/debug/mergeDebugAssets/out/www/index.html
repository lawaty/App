<!DOCTYPE html>
<html>
  <head>
  	<title>Bright Tech App</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Vendor Files -->
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="assets/vendor/venobox/venobox.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  	<!-- Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">

      <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/waypoints/jquery.waypoints.min.js"></script>
    <script src="assets/vendor/counterup/counterup.min.js"></script>
    <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/venobox/venobox.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>

    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>

    <script type="text/javascript">
      var token = localStorage.getItem("token");
      var username = localStorage.getItem("username");
      var user_id = localStorage.getItem("id");
      if(token !== null && username !== null && user_id !== null){
        $.ajax({
          url:"https://phpstack-482753-1854740.cloudwaysapps.com/BT/api.php",
          type:"POST",
          data: {
            "username": username,
            "token": token,
            "action": "auth" 
          },
          success: function(res){
            if(res == user_id)
              window.location.href="dashboard.html";
          },
          error: function(e){
            alert("Connection Error");
            location.reload();
          }
        });
      }
    </script>

  </head>

  <body>
    <main>
      <div class="container">
        <div class="login-form">
          <div class="login-logo">
            <img src="assets/img/logo-transparent.png" class="login-logo-img">
          </div>

          <div class="form">
            <div class="form-group">
              <input placeholder="username" id="login-username" class="form-control">
            </div>
            <div class="form-group">
              <input placeholder="password" type="password" id="password" class="form-control">
            </div>
            <div class="form-group">
              <input placeholder="google-authenticator code" id="code-login" class="form-control">
            </div>
            <center>
              <button class="btn btn-primary sign-in" onclick="login();">Sign In</button>
            </center>
          </div>
        </div>
      </div>
    </main>
  </body>

  <footer>
    <nav class="bottom-nav">
      <div class="bottom-nav-item">
        <div class="bottom-nav-link">
          <span onclick="location.reload();">Refresh</span>
        </div>
      </div>
    </nav>
  </footer>

  <script type="text/javascript">
    function login(){
      var username = $("input#login-username").val();
      var password = $("input#password").val();
      var code = $("input#code-login").val();
      if(username == "" && password == "")
        return true;
      $.ajax({
        url:"https://phpstack-482753-1854740.cloudwaysapps.com/BT/login.php",
        type:"POST",
        data:{
          "user-login":username,
          "pass-login":password,
          "code":code
        },
        success: function(response){
          var obj = JSON.parse(response);
          if(obj.note == "success" || obj.note == 'It is better to be logged in in two different devices'){
            localStorage.setItem("username", username);
            localStorage.setItem("token", obj.token);
            localStorage.setItem("id", obj.id);
            if(obj.note == "It is better to be logged in in two different devices")
              alert(obj.note);
            location.reload();
          }
          else{
            alert(obj.note);
          }
        },
        error: function(e){
          alert("Connection Error, Try Again...");
        }
      });     
    }
  </script>
</html>